# USD Rate Service

Простой API-сервис на Django, который возвращает актуальный курс USD к
RUB и хранит историю последних 10 запросов.

------------------------------------------------------------------------

## Возможности

-   Получение актуального курса USD/RUB из внешнего API (ЦБ РФ)
-   Кеширование запросов на 10 секунд
-   Хранение истории в базе данных (последние 10 записей)
-   Ответы в формате JSON
-   Graceful fallback при недоступности внешнего API
-   Конфигурация через переменные окружения
-   Стандартизированный формат API-ответов

------------------------------------------------------------------------

## Стек технологий

-   Python 3.x
-   Django
-   SQLite (по умолчанию)
-   Requests

------------------------------------------------------------------------

## Установка и запуск

### 1. Клонирование репозитория

``` bash
git clone <url-репозитория>
cd UsdRateService
```

### 2. Создание виртуального окружения

``` bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate   # Windows
```

### 3. Установка зависимостей

``` bash
pip install -r requirements.txt
```

### 4. Создание файла .env

Создайте файл `.env` в корне проекта:

``` env
CBR_URL=https://www.cbr-xml-daily.ru/daily_json.js
```

### 5. Применение миграций

``` bash
python manage.py migrate
```

### 6. Запуск сервера

``` bash
python manage.py runserver
```

------------------------------------------------------------------------

## API

### GET /get-current-usd/

Возвращает текущий курс USD/RUB и историю последних 10 запросов.

------------------------------------------------------------------------

## Пример успешного ответа

``` json
{
  "status": "success",
  "data": {
    "current_rate": 96.12,
    "timestamp": "2026-01-21T12:30:00Z",
    "history": [
      {
        "rate": 96.10,
        "timestamp": "2026-01-21T12:29:00Z"
      }
    ]
  }
}
```

------------------------------------------------------------------------

## Пример ответа с ошибкой

``` json
{
  "status": "error",
  "error": {
    "code": "RATE_FETCH_FAILED",
    "message": "Unable to fetch USD rate"
  }
}
```

------------------------------------------------------------------------

## Бизнес-логика

-   Внешний API вызывается не чаще одного раза в 10 секунд
-   Если запрос приходит раньше --- возвращается закешированное значение
-   Если внешний API недоступен:
    -   Возвращается последний сохранённый курс (если есть)
    -   Иначе возвращается ошибка 503

------------------------------------------------------------------------

## База данных

История хранится в базе данных в модели `USDRate`.

В базе всегда хранится не более 10 последних записей.

------------------------------------------------------------------------

## Архитектурные решения

-   Используется чистый Django (без DRF) для демонстрации понимания
    базовых механизмов
-   Ручная обработка ошибок и формирование JSON-ответов
-   Конфигурация через переменные окружения
-   Минимум внешних зависимостей


